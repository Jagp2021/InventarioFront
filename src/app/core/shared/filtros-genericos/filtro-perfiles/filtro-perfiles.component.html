<p-toast [key]="'fp-t-unique'"></p-toast>

<p-confirmDialog
  [style]="{ width: '50vw' }"
  [baseZIndex]="10000"
  [key]="'fp-cd-unique'"
></p-confirmDialog>

<div class="filtroGenericoMHCP">
  <p-dialog
    [id]="'filtroPerfil' + sId"
    [style]="{ width: nWidth }"
    [(visible)]="bAbrirFiltro"
    [modal]="true"
    [baseZIndex]="10000"
    [draggable]="false"
    [resizable]="false"
    [closable]="false"
  >
    <p-header>
      <div class="flex justify-content-between">
        <div>
          <i class="pi pi-search" style="margin-right: 10px"></i>
          {{ sTituloHeader }}
        </div>
        <div
          class="filtroGenericoMHCP-cerrar"
          (click)="fnObtenerCierreFiltro(false)"
        >
          X
        </div>
      </div>
    </p-header>

    <div class="col-12 flex">
      <div
        [ngClass]="{
          'w-full': !bMostrarResultados,
          'md:col-4': bMostrarResultados
        }"
        class="surface-card my-3 pt-3 pb-1 px-3 border-round shadow-2"
        [style]="{ height: 'fit-content' }"
      >
        <form
          class="field col-12"
          [formGroup]="frmBuscarFiltro"
          autocomplete="off"
        >
          <div class="formgrid grid">
            <div class="field col-12 md:col-12">
              <label htmlfor="codigo" class="frm-titulo"
                >C贸digo del perfil
              </label>

              <div class="col-12 p-0">
                <p-autoComplete
                  field=""
                  formControlName="codigoPerfil"
                  placeholder="Ingrese c贸digo"
                  [suggestions]="aPerfilesFiltrados"
                  [minLength]="1"
                  [dropdown]="false"
                  (completeMethod)="fnFiltrarPerfil($event, 'codigo')"
                ></p-autoComplete>
              </div>
            </div>

            <div class="field col-12 md:col-12">
              <label htmlfor="nombre" class="frm-titulo"
                >Nombre del perfil</label
              >

              <div class="col-12 p-0">
                <p-autoComplete
                  field=""
                  formControlName="nombrePerfil"
                  placeholder="Ingrese nombre"
                  [suggestions]="aPerfilesFiltrados"
                  [minLength]="1"
                  [dropdown]="false"
                  (completeMethod)="fnFiltrarPerfil($event, 'nombre')"
                ></p-autoComplete>
              </div>
            </div>

            <div class="field col-12 md:col-12">
              <label htmlfor="descripcion" class="frm-titulo"
                >Descripci贸n del perfil</label
              >

              <div class="col-12 p-0">
                <p-autoComplete
                  field=""
                  formControlName="descripcionPerfil"
                  placeholder="Ingrese descripci贸n"
                  [suggestions]="aPerfilesFiltrados"
                  [minLength]="1"
                  [dropdown]="false"
                  (completeMethod)="fnFiltrarPerfil($event, 'descripcion')"
                ></p-autoComplete>
              </div>
            </div>

            <div class="field col-12 md:col-12">
              <label htmlfor="rol" class="frm-titulo">Rol de negocio</label>

              <div class="col-12 p-0">
                <p-dropdown
                  filterBy="descripcion"
                  placeholder="Seleccione el rol"
                  formControlName="rolNegocio"
                  optionValue="sigla"
                  optionLabel="descripcion"
                  class="mt-1"
                  [options]="aRoles"
                  [filter]="true"
                  [showClear]="false"
                >
                </p-dropdown>
              </div>
            </div>

            <div class="field col-12 md:col-12">
              <label htmlfor="tipo" class="frm-titulo">Tipo de perfil</label>

              <div class="col-12 p-0">
                <p-dropdown
                  filterBy="descripcion"
                  placeholder="Seleccione tipo de perfil"
                  formControlName="tipoPerfil"
                  optionValue="sigla"
                  optionLabel="descripcion"
                  class="mt-1"
                  [options]="aTipoPerfil"
                  [filter]="true"
                  [showClear]="false"
                >
                </p-dropdown>
              </div>
            </div>

            <div class="field col-12 md:col-12">
              <label htmlfor="estado" class="frm-titulo"
                >Estado de perfil</label
              >

              <div class="col-12 p-0">
                <p-dropdown
                  filterBy="estado"
                  placeholder="Seleccione el estado"
                  formControlName="estado"
                  optionValue="valor"
                  optionLabel="estado"
                  class="mt-1"
                  [options]="aEstadoPerfil"
                  [filter]="false"
                  [showClear]="false"
                >
                </p-dropdown>
              </div>
            </div>

            <div class="col-12 p-0 mt-3 ml-2" *ngIf="bEsMultiple">
              <div class="field-radiobutton mt-1">
                <p-checkbox
                  value="true"
                  (click)="fnCambiarRadio()"
                  inputId="ny"
                ></p-checkbox>
                <label for="ny">Seleccionar todo</label>
              </div>
            </div>
          </div>
        </form>

        <div class="col-12 flex justify-content-end mt-0 mb-2 gap-2">
          <button
            pButton
            pRipple
            icon="pi pi-file-edit"
            label="Limpiar"
            class="p-button-outlined colorVerdeMHCP"
            (click)="fnLimpiarDatos()"
          ></button>
          <button
            pButton
            pRipple
            icon="pi pi-search"
            label="Buscar"
            class="p-button-success colorVerdeMHCP"
            type="submit"
            [disabled]="frmBuscarFiltro.invalid"
            (click)="fnBuscarResultados()"
          ></button>
        </div>
      </div>

      <div class="md:col-8" *ngIf="bMostrarResultados">
        <app-filtro-perfiles-resultado
          [oBuscar]="oBuscar"
          [bEsMultiple]="bEsMultiple"
          [bAbrirFiltro]="bAbrirFiltro"
          [bDevolverSoloID]="bDevolverSoloID"
          [oInformacionFiltro]="oInformacionFiltro"
          [bGuardarLocalStorage]="bGuardarLocalStorage"
          [bSeleccionarTodo]="bSeleccionarTodo"
          (bCerrarFiltro)="fnObtenerCierreFiltro($event)"
          (aPerfilesEmitados)="fnObtenerPerfiles($event)"
        ></app-filtro-perfiles-resultado>
      </div>
    </div>
  </p-dialog>
</div>
