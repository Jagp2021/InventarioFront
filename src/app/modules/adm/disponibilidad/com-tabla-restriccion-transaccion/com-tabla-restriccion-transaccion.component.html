<!-- Filtros Genéricos -->
<app-filtro-transacciones
  [sTituloHeader]="'Buscar Transacción'"
  [oInformacionFiltro]="aTransacciones"
  [oCamposFormulario]="oCamposFormularioTransaccion"
  [bEsMultiple]="true"
  [bDevolverSoloID]="false"
  [bAbrirFiltro]="bAbrirFiltroTransaccion"
  [bGuardarLocalStorage]="true"
  [nIndex]="0"
  (bCerrarFiltro)="fnObtenerCierreFiltroTransaccion($event)"
  (aTransacionesEmitadas)="fnObtenerDataFiltroTransaccion($event)"
></app-filtro-transacciones>

<!-- Código Base -->
<div class="field col-12 flex justify-content-end flex-wrap mb-0">
  <button
    pButton
    pRipple
    icon="pi pi-search"
    label="Buscar Transacción"
    class="p-button-success colorVerdeMHCP"
    type="submit"
    (click)="fnAbrirFiltroTransaccion()"
  ></button>
</div>

<div *ngIf="aTransacciones.length > 0">
  <app-lbl-subtitulo
    subtitulo="Transacciones Agregar"
    [bEsSubtituloPrincipal]="false"
  ></app-lbl-subtitulo>

  <div class="field col-12 p-0">
    <p-table
      #dt
      styleClass="p-datatable-gridlines p-datatable-striped"
      selectionMode="single"
      [loading]="false"
      [value]="aTransacciones"
      [scrollable]="false"
      [tableStyle]="{ 'min-width': '50rem' }"
      [rowHover]="true"
      [paginator]="aTransacciones.length > 10"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      currentPageReportTemplate="Mostrando {first} de {totalRecords} registros"
      [showCurrentPageReport]="true"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="codigo" [style]="{ width: '30rem' }">
            Código <p-sortIcon field="codigo"></p-sortIcon>
          </th>
          <th pSortableColumn="nombre">
            Nombre <p-sortIcon field="nombre"></p-sortIcon>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-aTransacciones let-ri="rowIndex">
        <tr
          (mouseenter)="fnMostrarOcultarBotones($event, ri, true, 'tb-trans')"
          (mouseleave)="fnMostrarOcultarBotones($event, ri, false, 'tb-trans')"
          [pSelectableRow]="aTransacciones"
        >
          <td>{{ aTransacciones.codigo }}</td>
          <td>{{ aTransacciones.nombre }}</td>

          <div id="button-{{ ri }}-tb-trans" class="no-mostrar">
            <button
              pButton
              pRipple
              pTooltip="Eliminar"
              tooltipPosition="top"
              type="button"
              icon="pi pi-trash"
              class="botonTableMHCP colorRojoMHCP"
              (click)="eliminarRestriccionTransaccionFiltro(aTransacciones, ri)"
            ></button>
          </div>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3" class="text-center">
            No se han encontrado registrados.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<div class="mt-5" *ngIf="aTransacciones.length > 0"></div>

<app-lbl-subtitulo
  subtitulo="Transacciones Existentes"
  [bEsSubtituloPrincipal]="false"
></app-lbl-subtitulo>

<div class="field col-12 p-0">
  <p-table
    #dt
    styleClass="p-datatable-gridlines p-datatable-striped"
    selectionMode="single"
    [loading]="false"
    [value]="oRestriccionTransaccion"
    [scrollable]="false"
    [tableStyle]="{ 'min-width': '50rem' }"
    [rowHover]="true"
    [paginator]="oRestriccionTransaccion.length > 10"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    currentPageReportTemplate="Mostrando {first} de {totalRecords} registros"
    [showCurrentPageReport]="true"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="codigo" [style]="{ width: '30rem' }">
          Código <p-sortIcon field="codigo"></p-sortIcon>
        </th>
        <th pSortableColumn="nombre">
          Nombre <p-sortIcon field="nombre"></p-sortIcon>
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-oRestriccionTransaccion let-ri="rowIndex">
      <tr
        (mouseenter)="fnMostrarOcultarBotones($event, ri, true, 'tb-restri')"
        (mouseleave)="fnMostrarOcultarBotones($event, ri, false, 'tb-restri')"
        [pSelectableRow]="oRestriccionTransaccion"
      >
        <td>{{ oRestriccionTransaccion.valorFuncionalidad.codigo }}</td>
        <td>
          {{ oRestriccionTransaccion.valorFuncionalidad.nombre }}
        </td>

        <div #actions id="button-{{ ri }}-tb-restri" class="no-mostrar">
          <button
            pButton
            pRipple
            pTooltip="Eliminar"
            tooltipPosition="top"
            type="button"
            icon="pi pi-trash"
            class="botonTableMHCP colorRojoMHCP"
            (click)="
              eliminarRestriccionTransaccion(oRestriccionTransaccion, ri)
            "
          ></button>
        </div>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="3" class="text-center">
          No se han encontrado registrados.
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
