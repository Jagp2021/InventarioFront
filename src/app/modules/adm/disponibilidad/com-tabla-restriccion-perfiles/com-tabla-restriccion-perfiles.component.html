<!-- Filtros Genéricos -->
<app-filtro-perfiles
  [sTituloHeader]="'Buscar Perfil'"
  [oInformacionFiltro]="aTransaccionesPerfil"
  [oCamposFormulario]="oCamposFormularioPerfil"
  [bEsMultiple]="true"
  [bDevolverSoloID]="false"
  [bAbrirFiltro]="bAbrirFiltroPerfil"
  [bGuardarLocalStorage]="true"
  (bCerrarFiltro)="fnObtenerCierreFiltroPerfil($event)"
  (aPerfilesEmitados)="fnObtenerDataFiltroPerfil($event)"
></app-filtro-perfiles>

<!-- Código Base -->
<div class="field col-12 flex justify-content-end flex-wrap mb-0">
  <button
    pButton
    pRipple
    icon="pi pi-search"
    label="Buscar Perfiles"
    class="p-button-success colorVerdeMHCP"
    type="submit"
    (click)="fnAbrirFiltroTransaccionPerfil()"
  ></button>
</div>

<div *ngIf="aTransaccionesPerfil.length > 0">
  <app-lbl-subtitulo
    subtitulo="Perfiles agregar"
    [bEsSubtituloPrincipal]="false"
  ></app-lbl-subtitulo>

  <div class="field col-12 p-0">
    <p-table
      #dt
      styleClass="p-datatable-gridlines p-datatable-striped"
      selectionMode="single"
      [loading]="false"
      [value]="aTransaccionesPerfil"
      [scrollable]="false"
      [tableStyle]="{ 'min-width': '50rem' }"
      [rowHover]="true"
      [paginator]="aTransaccionesPerfil.length > 10"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      currentPageReportTemplate="Mostrando {first} de {totalRecords} registros"
      [showCurrentPageReport]="true"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="codigo" [style]="{ width: '30rem' }">
            Nombre <p-sortIcon field="codigo"></p-sortIcon>
          </th>
          <th pSortableColumn="nombre">
            Tipo de perfil <p-sortIcon field="nombre"></p-sortIcon>
          </th>
          <th pSortableColumn="activo">
            Rol de negocio <p-sortIcon field="activo"></p-sortIcon>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-aTransaccionesPerfil let-ri="rowIndex">
        <tr
          (mouseenter)="fnMostrarOcultarBotones($event, ri, true, 'tb-perfex')"
          (mouseleave)="fnMostrarOcultarBotones($event, ri, false, 'tb-perfex')"
          [pSelectableRow]="aTransaccionesPerfil"
        >
          <td>{{ aTransaccionesPerfil.descripcion }}</td>
          <td>{{ aTransaccionesPerfil.tipoPerfil }}</td>
          <td>{{ aTransaccionesPerfil.rolNegocio }}</td>

          <div id="button-{{ ri }}-tb-perfex" class="no-mostrar">
            <button
              pButton
              pRipple
              pTooltip="Eliminar"
              tooltipPosition="top"
              type="button"
              icon="pi pi-trash"
              class="botonTableMHCP colorRojoMHCP"
              (click)="
                eliminarRestriccionPerfilFiltro(aTransaccionesPerfil, ri)
              "
            ></button>
          </div>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3" class="text-center">
            No se han encontrado registrados.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<div class="mt-5" *ngIf="aTransaccionesPerfil.length > 0"></div>

<app-lbl-subtitulo
  subtitulo="Perfiles Existentes"
  [bEsSubtituloPrincipal]="false"
></app-lbl-subtitulo>

<div class="field col-12 p-0">
  <p-table
    #dt
    styleClass="p-datatable-gridlines p-datatable-striped"
    selectionMode="single"
    [loading]="false"
    [value]="oListaPerfil"
    [scrollable]="false"
    [tableStyle]="{ 'min-width': '50rem' }"
    [rowHover]="true"
    dataKey="codigo"
    [paginator]="oListaPerfil.length > 10"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    currentPageReportTemplate="Mostrando {first} de {totalRecords} registros"
    [showCurrentPageReport]="true"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="codigo" [style]="{ width: '30rem' }">
          Nombre <p-sortIcon field="codigo"></p-sortIcon>
        </th>
        <th pSortableColumn="nombre">
          Tipo de perfil <p-sortIcon field="nombre"></p-sortIcon>
        </th>
        <th pSortableColumn="activo">
          Rol de negocio <p-sortIcon field="activo"></p-sortIcon>
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-oListaPerfil let-ri="rowIndex">
      <tr
        (mouseenter)="fnMostrarOcultarBotones($event, ri, true, 'tb-lispef')"
        (mouseleave)="fnMostrarOcultarBotones($event, ri, false, 'tb-lispef')"
        [pSelectableRow]="oListaPerfil"
      >
        <td>{{ oListaPerfil.valorPerfil.nombre }}</td>
        <td>{{ oListaPerfil.valorPerfil.tipoPerfil }}</td>
        <td>{{ oListaPerfil.valorPerfil.rolNegocio }}</td>

        <div #actions id="button-{{ ri }}-tb-lispef" class="no-mostrar">
          <button
            pButton
            pRipple
            pTooltip="Eliminar"
            tooltipPosition="top"
            type="button"
            icon="pi pi-trash"
            class="botonTableMHCP colorRojoMHCP"
            (click)="eliminarRestriccionPerfil(oListaPerfil, ri)"
          ></button>
        </div>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="3" class="text-center">
          No se han encontrado registrados.
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
